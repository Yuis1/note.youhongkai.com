---
{"dg-publish":true,"permalink":"/CS计算机科学/Drupal/Drupal定期删除未验证用户/","noteIcon":"","created":"2024-08-28T17:27:38.000+08:00","updated":"2024-04-23T23:53:32.000+08:00"}
---


要实现在Drupal中新用户注册后，如果未验证邮箱，在24小时后自动删除账户的功能，你可以使用Rules模块结合Cron任务来完成。以下是一个基本的步骤指南：

### 步骤1: 安装和启用模块

确保你已经安装并启用了[Rules](https://www.drupal.org/project/rules)模块。你可能还需要[Rules Scheduler](https://www.drupal.org/project/rules_scheduler)子模块（通常随Rules模块一起提供），它允许你计划将来执行的规则。   ——此处存在幻想

### 步骤2: 创建一个规则以计划未验证邮箱用户的删除

1. **转到Rules配置界面**：在Drupal后台，转到Configuration（配置）> Workflow（工作流）> Rules（规则）。
2. **创建新规则**：点击“Add new rule”（添加新规则）。
3. **事件选择**：在“React on event”（响应事件）下拉菜单中，选择“After saving a new user account”（保存新用户账户后）。这意味着每当有新用户注册时，这条规则会被触发。
4. **条件添加**（可选）：你可以添加条件来检查用户是否验证了邮箱。这可能需要自定义条件或使用用户账户上的特定字段来判断。
5. **操作添加**：在操作（Actions）部分，选择“Schedule component evaluation”（计划组件评估），这允许你在未来某个时间点触发另一个规则。如果Rules Scheduler子模块启用了，你应该看到这个选项。

### 步骤3: 创建一个用于删除未验证用户的规则组件

1. **创建新组件**：在Rules界面，选择Components（组件）标签，然后点击“Add new component”（添加新组件）。
2. **组件类型选择**：选择“Rule”（规则）作为组件类型。
3. **变量添加**：为这个组件添加一个用户类型的变量，这将允许你指定哪个用户账户将被处理。
4. **条件添加**（可选）：根据需要，添加适当的条件来检查用户是否未验证邮箱。
5. **操作添加**：添加一个操作来删除用户账户。选择“Delete entity”（删除实体），然后为它提供前面创建的用户变量。

### 步骤4: 链接两个规则

确保在第2步创建的规则中，作为操作添加的“Schedule component evaluation”指向了你在第3步创建的规则组件，并设置为在24小时后执行。

### 步骤5: 配置Cron

确保你的Drupal站点的Cron任务被正确配置且定期运行。Rules Scheduler依赖于Cron来执行计划中的任务。

这个解决方案提供了一种使用Rules模块和Rules Scheduler在Drupal中实现特定业务逻辑的方法。请注意，这个指南提供了一个概念性的解决方案，具体实现可能需要根据你的站点配置和需求进行调整。你可能需要在条件检查和操作执行时进行一些自定义开发，特别是在检查用户是否已验证邮箱这一步。